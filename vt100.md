# VT100 Specification

Here is the specification of the VT100 terminal that I used to write the vt100 package. It is based on the manual available here: https://www.vt100.net/docs/vt100-ug/

The state of a VT100 terminal consists of:

* An *input buffer* that holds up to 64 bytes (FIFO)
* A *keyboard buffer* that holds up to 7 bytes (FIFO)
* The *answerback message*, a string of length $\leq 20$
* The *cursor position*, a position $(x,y)$ where $1 \leq x \leq 80$, $1 \leq y \leq 24$
* The set of *tab stops*, each of which is an $x$-coordinate between $1$ and $80$ inclusive, all distinct
* The *new line mode* status, which may be either *set* or *reset*
* The *character set*, which may be G0 or G1
* The *transmission mode*, which may be either *XON* or *XOFF*
* The *top margin* and *bottom margin*. We must have $1 \leq$ top margin $<$ bottom margin $\leq 24$
* The *origin mode* or *DECOM*, which may be either *set* or *reset*
* The *processor option* (STP), which is either 0 or 1
* The *advanced video option* (AVO), which is either 0 or 1
* The *graphics processor option* (GPO), which is either 0 or 1
* The *screen contents*, an 80x24 array of characters
* The *keypad application mode*, which may be *set* or *reset*

The *left margin* is always 1 and the *right margin* is always 80.

The terminal can perform the following behaviours:

1. When the terminal receives a character $c$ from the host then:
    1. If $c$ is NUL (000) or DEL (177), no action. Otherwise:
    1. If the input buffer is not full, then $c$ is added to the input buffer.
        * If this takes the input buffer to 32 characters, then the terminal sends the XOFF signal to the host.
    1. If the input buffer was full, then the contents of the input buffer do not change and the terminal prints the error (checkerboard) character.
1. The terminal may consume the oldest bytes in the input buffer and behave as follows. (If this takes the input buffer down to $\leq 16$ characters, then the terminal sends the XON signal to the host.)
    * ENQ (005) - Send the answerback message to the host
    * BEL (007) - Sound the bell
    * BS (010) - Move the cursor one space to the left if it is not at the left margin. (If it is, no action)
    * HT (011) - Move the cursor right to the next tab stop, or to the right margin if there is no tab stop to the right
    * LF (012) or VT (013) or FF (014) - If new line mode is set, move the cursor down one line and to column 0. (TODO: Scroll screen?) If new line mode is reset, move cursor down one line.
    * CR (015) - Move the cursor to column 0
    * SO (016) - Switch character set to G1
    * SI (017) - Switch character set to G0
    * XON (021) - Switch transmission mode to XON
    * XOFF (023) - Switch transmission mode to XOFF
    * ESC [ <n> D - Move cursor n spaces left, or one space left if $n = 0$
    * ESC [ <n> B - Move cursor n spaces down, or one line down if $n = 0$
    * ESC [ <n> C - Move cursor n spaces right, or one space right if $n = 0$
    * ESC [ <m> ; <n> H - Move the cursor to line m, column n. If DECOM is set, then position (1,1) is the top margin, left column. If DECOM is reset, then position (1,1) is the top of the screen, left margin
    * ESC [ H - Move the cursor to the origin, position (1,1). (Again, which position this is depends on the DECOM mode)
    * ESC [ <n> A - Move cursor n spaces up, or one space up if $n = 0$
    * ESC [ c or ESC [ 0 c or ESC Z - Terminal sends the response ESC [ ? 1 ; <n> c, where n is as follows:
        0 	Base VT100, no options
        1 	Processor options (STP)
        2 	Advanced video option (AVO)
        3 	AVO and STP
        4 	Graphics processor option (GPO)
        5 	GPO and STP
        6 	GPO and AVO
        7 	GPO, STP, and AVO
    * ESC # 8 - Fill the screen with Es
    * ESC # 3 - Make the current line the top half of a double-height double-width line
    * ESC # 4 - Make the current line the bottom half of a double-height double-width line
    * ESC # 6 - Make the current line double-width single-height
    * ESC = - Set keypad application mode
    * ESC > - Reset keypad application mode
    * A partial escape sequence followed by CAN (030) or SUB (032) - no action